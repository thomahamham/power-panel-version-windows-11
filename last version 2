-- โหลด Library Fluent และ Addons
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/thomahamham/power-panel-version-windows-11/refs/heads/main/InterfaceManager.lua"))()

-- ตั้งค่าเวอร์ชั่น (แค่ครั้งเดียว)
local ScriptVersion = "2.0"
local VersionUrl = "https://raw.githubusercontent.com/thomahamham/power-panel-version-windows-11/refs/heads/main/versiondev"

-- หน้าต่างหลัก
local Window = Fluent:CreateWindow({
    Title = "Power Panel Windows 11 English " .. ScriptVersion .. " (เวอร์ชั่นสำรอง " .. Fluent.Version .. ")",
    SubTitle = "power panel ver " .. ScriptVersion,
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- สร้างแท็บทั้งหมด
local Tabs = {
    common = Window:AddTab({ Title = "Common", Icon = "" }),
    user = Window:AddTab({ Title = "User", Icon = "" }),
    tp = Window:AddTab({ Title = "TP", Icon = "" }),
    places = Window:AddTab({ Title = "Places", Icon = "" }),
    killaura = Window:AddTab({ Title = "Kill Aura", Icon = "" }),
    chop = Window:AddTab({ Title = "Chop", Icon = "" }),
    dragitems = Window:AddTab({ Title = "Drag Items", Icon = "" }),
    misc = Window:AddTab({ Title = "Misc", Icon = "" }),
    night = Window:AddTab({ Title = "99 Night Scripts", Icon = "" }),
    other = Window:AddTab({ Title = "Other Scripts", Icon = "" }),
    up = Window:AddTab({ Title = "Update", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "" }),
    credit = Window:AddTab({ Title = "Credit", Icon = "" }),
    dev = Window:AddTab({ Title = "Developer", Icon = "" }),
}

-- ตัวแปรหลัก
local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

-- ตัวแปรฟังก์ชัน
local flying = false
local vv, gyro
local flySpeed = 200
local superSpeed = false
local runSpeed = 32
local noclipEnabled = false
local infJumpEnabled = false

-- === ฟังก์ชันบิน ===
local function startFlying()
    if flying then return end
    flying = true
    humanoid.PlatformStand = true
    vv = Instance.new("BodyVelocity")
    vv.MaxForce = Vector3.new(1e5,1e5,1e5)
    vv.P = 1250
    vv.Velocity = Vector3.zero
    vv.Parent = hrp
    gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(4e5,4e5,4e5)
    gyro.P = 3000
    gyro.CFrame = hrp.CFrame
    gyro.Parent = hrp
    Fluent:Notify({Title = "Fly Mode On!", Content = "Use W,A,S,D,Space,Ctrl to control", Duration = 3})
end

local function stopFlying()
    if not flying then return end
    flying = false
    if vv then vv:Destroy() vv=nil end
    if gyro then gyro:Destroy() gyro=nil end
    humanoid.PlatformStand = false
    Fluent:Notify({Title = "Fly Mode Off", Content = "Landed successfully", Duration = 3})
end

-- ฟังก์ชันวิ่งเร็ว
local function toggleSpeed(on)
    superSpeed = on
    humanoid.WalkSpeed = superSpeed and runSpeed or 16
    Fluent:Notify({Title = superSpeed and "Super Speed On" or "Super Speed Off", Content = superSpeed and "Running at max speed!" or "Back to normal speed", Duration = 3})
end

-- ตัวแปรระบบอื่นๆ จาก Rayfield
local godmodeToggled = false

-- ลูปหลักสำหรับบินและอื่นๆ
RS.RenderStepped:Connect(function()
    if flying and vv and gyro and hrp and humanoid then
        local cam = workspace.CurrentCamera
        if not cam then return end
        local forward = Vector3.new(cam.CFrame.LookVector.X, 0, cam.CFrame.LookVector.Z).Unit
        local right = Vector3.new(cam.CFrame.RightVector.X, 0, cam.CFrame.RightVector.Z).Unit
        local moveVec = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec += forward end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec -= forward end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec -= right end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec += right end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveVec += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then moveVec += Vector3.new(0,-1,0) end
        if moveVec.Magnitude > 0 then vv.Velocity = moveVec.Unit * flySpeed else vv.Velocity = Vector3.zero end
        if moveVec.X ~= 0 or moveVec.Z ~= 0 then
            gyro.CFrame = CFrame.new(hrp.Position, hrp.Position + Vector3.new(moveVec.X, 0, moveVec.Z))
        end
    end
end)

RS.Stepped:Connect(function()
    if noclipEnabled and char then
        for _,part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

UIS.JumpRequest:Connect(function()
    if infJumpEnabled and humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- รีเซ็ตเมื่อ respawn
player.CharacterAdded:Connect(function(c)
    char = c
    hrp = c:WaitForChild("HumanoidRootPart")
    humanoid = c:WaitForChild("Humanoid")
    stopFlying()
    toggleSpeed(false)
    noclipEnabled = false
    infJumpEnabled = false
    -- โหลด config ถ้ามี
end)

--------------------------------------------------------------------------------------------------------------
-- COMMON TAB (จาก MainTab ใน Rayfield)
--------------------------------------------------------------------------------------------------------------
do
    Tabs.common:AddParagraph({
        Title = "Common Features",
        Content = "Frequently used features like godmode, home TP, item fillers"
    })

    Tabs.common:AddButton({
        Title = "Godmode",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/godmode"))()
            Fluent:Notify({ Title = "Success!", Content = "Godmode Active", Duration = 3 })
        end
    })

    Tabs.common:AddButton({
        Title = "TP Home",
        Callback = function()
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")
            hrp.CFrame = CFrame.new(12.079488, 0, 3.2662038, 0, 0, 1, 0, 1, 0, -1, 0, 0)
            Fluent:Notify({Title="Quick TP!", Content="Arrived", Duration=2})
        end
    })

    Tabs.common:AddButton({
        Title = "Fill Fire",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getfire"))()
            Fluent:Notify({ Title = "Success!", Content = "Fire filled", Duration = 3 })
        end
    })

    Tabs.common:AddButton({
        Title = "Fill Bandage",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getbandage"))()
            Fluent:Notify({ Title = "Success!", Content = "Bandages filled", Duration = 3 })
        end
    })

    Tabs.common:AddButton({
        Title = "Fill Iron",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getiron"))()
            Fluent:Notify({ Title = "Success!", Content = "Iron filled", Duration = 3 })
        end
    })

    local flyToggle = Tabs.common:AddToggle("FlyToggle", { Title = "Toggle Fly", Default = false })
    flyToggle:OnChanged(function(val)
        if val then startFlying() else stopFlying() end
    end)

    Tabs.common:AddButton({
        Title = "Remove Fog Permanently",
        Callback = function()
            local Lighting = game:GetService("Lighting")
            Lighting.FogEnd = 100000
            Lighting.FogStart = 0
            for _, v in pairs(Lighting:GetDescendants()) do
                if v:IsA("Atmosphere") then
                    v:Destroy()
                end
            end
            Lighting:GetPropertyChangedSignal("FogEnd"):Connect(function()
                Lighting.FogEnd = 100000
            end)
            Lighting.DescendantAdded:Connect(function(v)
                if v:IsA("Atmosphere") then
                    v:Destroy()
                end
            end)
            Fluent:Notify({Title = "Fog Removed!", Content = "Visibility maxed permanently", Duration = 4})
        end
    })

    -- Keybinds (Fluent has AddKeybind)
    Tabs.common:AddKeybind("GodmodeKey", {
        Title = "Godmode Key",
        Default = "KeypadOne",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/godmode"))()
            Fluent:Notify({Title = "Godmode On!", Content = "Active", Duration = 4})
        end
    })

    Tabs.common:AddKeybind("TPHomeKey", {
        Title = "TP Home Key",
        Default = "KeypadTwo",
        Callback = function()
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")
            hrp.CFrame = CFrame.new(12.079488, 0, 3.2662038, 0, 0, 1, 0, 1, 0, -1, 0, 0)
            Fluent:Notify({Title = "TP Home", Content = "Arrived", Duration = 2})
        end
    })

    -- Add more keybinds similarly for fill fire, bandage, iron, fly, fog
end

--------------------------------------------------------------------------------------------------------------
-- USER TAB (Merged with Rayfield's fly/speed)
--------------------------------------------------------------------------------------------------------------
do
    Tabs.user:AddParagraph({
        Title = "User Controls",
        Content = "Fly, speed, noclip, inf jump"
    })

    local ToggleFlight = Tabs.user:AddToggle("ToggleFlight", { Title = "Toggle Fly", Default = false })
    ToggleFlight:OnChanged(function(val)
        if val then startFlying() else stopFlying() end
    end)

    local SliderFlySpeed = Tabs.user:AddSlider("SliderFlySpeed", {
        Title = "Fly Speed",
        Default = 20, Min = 1, Max = 100, Rounding = 1,
    })
    SliderFlySpeed:OnChanged(function(val) flySpeed = val * 10 end)  -- Adjust as needed

    local SliderRunSpeed = Tabs.user:AddSlider("SliderRunSpeed", {
        Title = "Run Speed",
        Default = 16, Min = 16, Max = 1000, Rounding = 1
    })
    SliderRunSpeed:OnChanged(function(val)
        runSpeed = val
        toggleSpeed(superSpeed)
    end)

    local ToggleSuperSpeed = Tabs.user:AddToggle("ToggleSuperSpeed", { Title = "Toggle Super Speed", Default = false })
    ToggleSuperSpeed:OnChanged(function(val) toggleSpeed(val) end)

    local ToggleNoClip = Tabs.user:AddToggle("ToggleNoClip", { Title = "Toggle Noclip", Default = false })
    ToggleNoClip:OnChanged(function(val) noclipEnabled = val end)

    local ToggleInfJump = Tabs.user:AddToggle("ToggleInfJump", { Title = "Toggle Inf Jump", Default = false })
    ToggleInfJump:OnChanged(function(val) infJumpEnabled = val end)
end

--------------------------------------------------------------------------------------------------------------
-- TP TAB (Merged with drag bodies)
--------------------------------------------------------------------------------------------------------------
do
    -- Existing TP to friend and drag by name

    -- Add drag all bodies from Rayfield
    Tabs.tp:AddButton({
        Title = "Drag All Bodies",
        Callback = function()
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")

            local remoteEvents = ReplicatedStorage:FindFirstChild("RemoteEvents")
            local startDragging = remoteEvents and remoteEvents:FindFirstChild("RequestStartDraggingItem")
            local stopDragging  = remoteEvents and remoteEvents:FindFirstChild("StopDraggingItem")

            if not (startDragging and stopDragging) then
                Fluent:Notify({Title = "Error", Content = "RemoteEvents not found", Duration = 5})
                return
            end

            local folder = Workspace:FindFirstChild("Characters")
            if not folder then return end
            local bodies = {}
            for _, obj in ipairs(folder:GetChildren()) do
                if obj.Name:sub(-5) == " Body" then
                    table.insert(bodies, obj)
                end
            end

            if #bodies == 0 then
                Fluent:Notify({Title = "No Bodies", Content = "No dead bodies found", Duration = 4})
                return
            end

            Fluent:Notify({Title = "Dragging Bodies", Content = "Found " .. #bodies .. " bodies", Duration = 3})

            task.spawn(function()
                for _, body in ipairs(bodies) do
                    if body and body.Parent then
                        local inst = body
                        startDragging:FireServer(inst)
                        task.wait(0.02)

                        local refPart = body.PrimaryPart or body:FindFirstChildWhichIsA("BasePart")
                        if refPart then
                            body:PivotTo(hrp.CFrame * CFrame.new(0, 0, -5))  -- Adjust offset
                        end

                        task.wait(0.05)
                        stopDragging:FireServer(inst)
                        task.wait(0.2)  -- Delay
                    end
                end
                Fluent:Notify({Title = "Success!", Content = "Dragged " .. #bodies .. " bodies!", Duration = 4})
            end)
        end
    })

    -- Add keybind for drag all
    Tabs.tp:AddKeybind("DragAllKey", {
        Title = "Drag All Key",
        Default = "KeypadEight",
        Callback = function()
            -- Same as above callback
        end
    })
end

--------------------------------------------------------------------------------------------------------------
-- PLACES TAB (Warp to locations)
--------------------------------------------------------------------------------------------------------------
do
    Tabs.places:AddParagraph({
        Title = "Warp to Places",
        Content = "Teleport to various landmarks"
    })

    local Locations = {}
    local thaiNames = {
        StrongHold = "ปราสาทเพชร",
        Fairy_House = "บ้านนางฟ้า", 
        Ice_Temple = "วิหารน้ำแข็ง",
        Jail_Cellar1 = "ห้องขังใต้ดิน 1",
        Jail_Cellar2 = "ห้องขังใต้ดิน 2", 
        Jail_Cellar3 = "ห้องขังใต้ดิน 3",
        Jail_Cellar4 = "ห้องขังใต้ดิน 4",
        SkillsBuilding = "อาคารฝึกสกิล",
        Snow_Clothing_Shop = "ร้านเสื้อผ้าหิมะ",
        ToolWorkshop = "โรงงานเครื่องมือ"
    }

    local function getCFrameFromLandmark(landmark)
        if landmark:IsA("Model") then
            if landmark.PrimaryPart then
                return landmark.PrimaryPart.CFrame
            else
                for _, part in pairs(landmark:GetChildren()) do
                    if part:IsA("BasePart") then
                        return part.CFrame
                    end
                end
            end
        elseif landmark:IsA("BasePart") then
            return landmark.CFrame
        end
        return nil
    end

    local function refreshLocations()
        Locations = {}
        local folder = Workspace:FindFirstChild("Map") and Workspace.Map:FindFirstChild("Landmarks")
        
        if folder then
            for _, landmark in pairs(folder:GetChildren()) do
                local name = landmark.Name
                local cf = getCFrameFromLandmark(landmark)
                
                if cf then
                    local pos = cf.Position
                    local displayName = thaiNames[name] or name:gsub("_", " ")
                    Locations[name] = {
                        CFrame = CFrame.new(pos.X, pos.Y + 3, pos.Z),
                        Display = displayName
                    }
                end
            end
        end
        
        Fluent:Notify({Title = "Refresh Success!", Content = "Found " .. #Locations .. " places", Duration = 4})
    end

    Tabs.places:AddButton({
        Title = "Refresh Locations",
        Callback = refreshLocations
    })

    -- Initial refresh
    refreshLocations()

    -- Add buttons dynamically? But Fluent doesn't have dynamic add, so perhaps dropdown
    local placeDropdown = Tabs.places:AddDropdown("PlaceDropdown", {
        Title = "Select Place",
        Values = {}, Multi = false
    })

    local function updatePlaceList()
        local names = {}
        for _, data in pairs(Locations) do
            table.insert(names, data.Display)
        end
        placeDropdown:SetValues(names)
    end

    updatePlaceList()

    Tabs.places:AddButton({
        Title = "Warp to Selected",
        Callback = function()
            local selected = placeDropdown.Value
            if not selected then return end
            for key, data in pairs(Locations) do
                if data.Display == selected then
                    local char = player.Character or player.CharacterAdded:Wait()
                    local hrp = char:WaitForChild("HumanoidRootPart")
                    hrp.CFrame = data.CFrame
                    Fluent:Notify({Title = "Warp Success!", Content = "To " .. data.Display, Duration = 3})
                    break
                end
            end
        end
    })
end

--------------------------------------------------------------------------------------------------------------
-- KILLAURA TAB
--------------------------------------------------------------------------------------------------------------
do
    local killAuraEnabled = false
    local killAuraRange = 150
    local killAuraCount = 0
    local killAuraHitDelay = 0
    local Characters = Workspace:WaitForChild("Characters")

    local allWeapons = {
        "Scythe", "Spear", "Infernal Sword", "Morningstar", "Katana", "Laser Sword", "Ice Sword",
        "Trident", "Poison Spear", "Infernal Sword", "Cultist King Mace",
        "Obsidiron Hammer", "Scythe", "Vampire Scythe", "Old Axe", "Strong Axe", "Good Axe"
    }

    local function getWeapon()
        if not player:FindFirstChild("Inventory") then return nil end
        
        local priorityWeapons = {"Scythe", "Infernal Sword", "Strong Axe", "Good Axe", "Vampire Scythe", "Laser Sword", "Infernal Sword", "Ice Sword", "Poison Spear","Katana", "Spear", "Trident", "Scythe", "Morningstar", "Old Axe", "Cultist King Mace"}
        local normalWeapons = {"Obsidiron Hammer"}
        
        for _, weaponName in ipairs(priorityWeapons) do
            local weapon = player.Inventory:FindFirstChild(weaponName)
            if weapon then return weapon end
        end
        
        for _, weaponName in ipairs(normalWeapons) do
            local weapon = player.Inventory:FindFirstChild(weaponName)
            if weapon then return weapon end
        end
        
        return nil
    end

    local function damage(target, tool)
        if not tool then return end
        local remoteEvents = ReplicatedStorage:FindFirstChild("RemoteEvents")
        if not remoteEvents then return end
        local evt = remoteEvents:FindFirstChild("ToolDamageObject")
        if not evt then return end
        
        local hrp = target:FindFirstChild("HumanoidRootPart")
        local cf = hrp and hrp.CFrame or CFrame.new()
        
        evt:InvokeServer(target, tool, tostring(killAuraCount).."_7367831688", cf)
    end

    Tabs.killaura:AddToggle("KillAuraToggle", { Title = "Toggle Kill Aura", Default = false }):OnChanged(function(bool)
        killAuraEnabled = bool
        Fluent:Notify({Title = "Kill Aura", Content = bool and "On" or "Off", Duration = 3})
    end)

    Tabs.killaura:AddSlider("HitSpeedSlider", {
        Title = "Hit Speed (low=fast)",
        Default = 0, Min = 0, Max = 0.5, Rounding = 1,
    }):OnChanged(function(val) killAuraHitDelay = val end)

    local weaponModes = {"Auto (Priority)", "Good Axe Only", "Vampire Scythe Only", "Laser Sword Only", "All Weapons (Random)"}
    local selectedMode = "Auto (Priority)"
    Tabs.killaura:AddDropdown("WeaponMode", {
        Title = "Weapon Mode",
        Values = weaponModes, Default = selectedMode
    }):OnChanged(function(opt) selectedMode = opt end)

    Tabs.killaura:AddSlider("KillAuraRange", {
        Title = "Range (Studs)",
        Default = 100, Min = 50, Max = 100, Rounding = 5,
    }):OnChanged(function(val) killAuraRange = val end)

    -- Status label, but Fluent no label, use paragraph
    local statusPara = Tabs.killaura:AddParagraph({Title = "Status", Content = "Kills: 0 | Range: 150 | Speed: 0s | Weapon: Ready"})

    Tabs.killaura:AddButton({
        Title = "Reset Stats",
        Callback = function()
            killAuraCount = 0
            statusPara:Set("Kills: 0 | Range: " .. killAuraRange .. " | Speed: " .. killAuraHitDelay .. "s | Weapon: Ready")
        end
    })

    Tabs.killaura:AddButton({
        Title = "Check Inventory (15 Weapons)",
        Callback = function()
            local inv = player:FindFirstChild("Inventory")
            if not inv then Fluent:Notify({Title="Error", Content="No Inventory", Duration=3}) return end
            
            local found = 0
            for _, wName in ipairs(allWeapons) do
                if inv:FindFirstChild(wName) then found += 1 end
            end
            
            Fluent:Notify({Title = "Inventory Scan", Content = "Found " .. found .. "/15 weapons", Duration = 4})
        end
    })

    task.spawn(function()
        while task.wait() do
            if not killAuraEnabled then 
                statusPara:Set("Kills: " .. killAuraCount .. " | Range: " .. killAuraRange .. " | OFF")
                task.wait(0.5)
                continue 
            end
            
            local weapon
            if selectedMode == "Auto (Priority)" then
                weapon = getWeapon()
            elseif selectedMode == "All Weapons (Random)" then
                local available = {}
                for _, wName in ipairs(allWeapons) do
                    local w = player.Inventory:FindFirstChild(wName)
                    if w then table.insert(available, w) end
                end
                if #available > 0 then weapon = available[math.random(1, #available)] end
            else
                local targetName = selectedMode:gsub(" Only", "")
                weapon = player.Inventory:FindFirstChild(targetName)
            end
            
            local myChar = player.Character
            if not myChar or not myChar:FindFirstChild("HumanoidRootPart") or not weapon then 
                statusPara:Set("Kills: " .. killAuraCount .. " | No weapon")
                continue 
            end
            
            local myHRP = myChar.HumanoidRootPart
            statusPara:Set("Kills: " .. killAuraCount .. " | Range: " .. killAuraRange .. " | Speed: " .. killAuraHitDelay .. "s | " .. weapon.Name)
            
            for _, v in ipairs(Characters:GetChildren()) do
                if v:IsA("Model") and v ~= myChar and v:FindFirstChild("HumanoidRootPart") and not v.Name:find(" Body") then
                    local dist = (v.HumanoidRootPart.Position - myHRP.Position).Magnitude
                    if dist <= killAuraRange then
                        killAuraCount += 1
                        damage(v, weapon)
                        statusPara:Set("Kills: " .. killAuraCount .. " | ATTACKING")
                        task.wait(killAuraHitDelay)
                    end
                end
            end
        end
    end)

    Tabs.killaura:AddToggle("AutoEquip", { Title = "Auto Equip", Default = false }):OnChanged(function(bool)
        task.spawn(function()
            while bool do
                task.wait(0.5)
                local weapon = getWeapon()
                if weapon and player.Character then
                    local humanoid = player.Character:FindFirstChild("Humanoid")
                    if humanoid then humanoid:EquipTool(weapon) end
                end
            end
        end)
    end)
end

--------------------------------------------------------------------------------------------------------------
-- CHOP TAB
--------------------------------------------------------------------------------------------------------------
do
    local chopAuraToggle = false
    local auraRadius = 100
    local chopDelay = 0.3
    local currentAmount = 0

    local toolsDamageIDs = {
        ["Old Axe"] = "3_7367831688",
        ["Good Axe"] = "112_7367831688",
        ["Strong Axe"] = "116_7367831688"
    }

    local function getAxeTool()
        for toolName, _ in pairs(toolsDamageIDs) do
            local tool = player:FindFirstChild("Inventory") and player.Inventory:FindFirstChild(toolName)
            if tool then
                return tool
            end
        end
        return nil
    end

    local function equipTool(tool)
        if tool then
            pcall(function()
                ReplicatedStorage.RemoteEvents.EquipItemHandle:FireServer("FireAllClients", tool)
            end)
        end
    end

    local function unequipTool(tool)
        if tool then
            pcall(function()
                ReplicatedStorage.RemoteEvents.UnequipItemHandle:FireServer("FireAllClients", tool)
            end)
        end
    end

    local function chopAuraLoop()
        while chopAuraToggle do
            task.wait(chopDelay)
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:FindFirstChild("HumanoidRootPart")
            if not hrp then continue end

            local tool = getAxeTool()
            if not tool then 
                task.wait(1)
                continue 
            end

            equipTool(tool)

            local trees = {}

            local function addTreesFromFolder(folder)
                if not folder then return end
                for _, obj in ipairs(folder:GetChildren()) do
                    if obj:IsA("Model") and (
                        obj:FindFirstChild("TreeClass") or
                        obj.Name == "Small Tree" or 
                        obj.Name == "Big Tree" or
                        obj.Name:find("Tree")
                    ) then
                        table.insert(trees, obj)
                    end
                end
            end

            local map = Workspace:FindFirstChild("Map")
            if map then
                addTreesFromFolder(map:FindFirstChild("Foliage"))
                addTreesFromFolder(map:FindFirstChild("Landmarks"))
            end

            for _, tree in ipairs(trees) do
                if not chopAuraToggle then break end
                local trunk = tree:FindFirstChild("Trunk")
                if trunk and trunk:IsA("BasePart") then
                    local distance = (trunk.Position - hrp.Position).Magnitude
                    if distance <= auraRadius then
                        currentAmount = currentAmount + 1
                        task.spawn(function()
                            while chopAuraToggle and tree and tree.Parent do
                                pcall(function()
                                    ReplicatedStorage.RemoteEvents.ToolDamageObject:InvokeServer(
                                        tree,
                                        tool,
                                        tostring(currentAmount) .. "_7367831688",
                                        CFrame.new(-2.962610244751, 4.5547881126404, -75.950843811035,
                                            0.89621275663376, -1.3894891459643e-08, 0.44362446665764,
                                            -7.994568895775e-10, 1, 3.293635941759e-08,
                                            -0.44362446665764, -2.9872644802253e-08, 0.89621275663376)
                                    )
                                end)
                                task.wait(chopDelay)
                            end
                        end)
                    end
                end
            end
        end
        local tool = getAxeTool()
        if tool then unequipTool(tool) end
    end

    Tabs.chop:AddToggle("ChopAuraToggle", { Title = "Enable Chop Aura", Default = false }):OnChanged(function(Value)
        chopAuraToggle = Value
        if Value then
            task.spawn(chopAuraLoop)
            Fluent:Notify({Title = "Chop Aura On!", Duration = 3})
        else
            Fluent:Notify({Title = "Chop Aura Off", Duration = 2})
        end
    end)

    Tabs.chop:AddSlider("ChopRadius", {
        Title = "Range (Studs)",
        Default = 100, Min = 10, Max = 100, Rounding = 10
    }):OnChanged(function(Value) auraRadius = Value end)

    Tabs.chop:AddSlider("ChopSpeed", {
        Title = "Chop Speed (low=fast, risk ban)",
        Default = 0.3, Min = 0.05, Max = 0.3, Rounding = 0.05
    }):OnChanged(function(Value) chopDelay = Value end)

    -- Tree HP Bars
    local TreeHPToggle = false
    local TreeHPConnections = {}
    local TreeHPGuis = {}

    local function CreateTreeHPBar(tree)
        if not tree or TreeHPGuis[tree] then return end
        
        local trunk = tree:FindFirstChild("Trunk")
        if not trunk then return end
        
        local bill = Instance.new("BillboardGui")
        bill.Name = "TreeHPBar"
        bill.Adornee = trunk
        bill.Size = UDim2.new(3, 0, 0.6, 0)
        bill.StudsOffset = Vector3.new(0, 4, 0)
        bill.AlwaysOnTop = true
        bill.LightInfluence = 0
        bill.Parent = trunk
        
        local frame = Instance.new("Frame", bill)
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundTransparency = 0.3
        frame.BackgroundColor3 = Color3.new(0, 0, 0)
        frame.BorderSizePixel = 0
        frame.ClipsDescendants = true
        
        local corner1 = Instance.new("UICorner", frame)
        corner1.CornerRadius = UDim.new(0, 6)
        
        local fill = Instance.new("Frame", frame)
        fill.Name = "Fill"
        fill.Size = UDim2.new(1, 0, 1, 0)
        fill.Position = UDim2.new(0, 0, 0, 0)
        fill.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
        fill.BorderSizePixel = 0
        
        local corner2 = Instance.new("UICorner", fill)
        corner2.CornerRadius = UDim.new(0, 4)
        
        TreeHPGuis[tree] = {Billboard = bill, Fill = fill, Frame = frame}
    end

    local function UpdateTreeHPBar(tree)
        local guiData = TreeHPGuis[tree]
        if not guiData then return end
        
        local currentHP = tree:GetAttribute("Health") or 0
        local maxHP = tree:GetAttribute("MaxHealth") or 100
        local percent = math.clamp(currentHP / maxHP, 0, 1)
        
        guiData.Fill.Size = UDim2.new(percent, 0, 1, 0)
        guiData.Fill:TweenSize(UDim2.new(percent, 0, 1, 0), "Out", "Quad", 0.1, true)
        
        if percent > 0.7 then
            guiData.Fill.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
        elseif percent > 0.4 then
            guiData.Fill.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
        elseif percent > 0.2 then
            guiData.Fill.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
        else
            guiData.Fill.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        end
    end

    local function EnableTreeHP()
        if TreeHPToggle then return end
        TreeHPToggle = true
        
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("Model") and 
               (obj:FindFirstChild("TreeClass") or 
                obj.Name:find("Tree") or 
                obj.Name == "Small Tree" or 
                obj.Name == "Big Tree") and 
               obj:FindFirstChild("Trunk") then
                CreateTreeHPBar(obj)
            end
        end
        
        TreeHPConnections.Added = workspace.DescendantAdded:Connect(function(obj)
            if not TreeHPToggle then return end
            task.wait(0.2)
            if obj:IsA("Model") and 
               (obj:FindFirstChild("TreeClass") or obj.Name:find("Tree")) and 
               obj:FindFirstChild("Trunk") then
                CreateTreeHPBar(obj)
            end
        end)
        
        TreeHPConnections.Update = game:GetService("RunService").Heartbeat:Connect(function()
            if not TreeHPToggle then return end
            for tree, _ in pairs(TreeHPGuis) do
                if tree and tree.Parent and tree:FindFirstChild("Trunk") then
                    UpdateTreeHPBar(tree)
                else
                    if TreeHPGuis[tree] then
                        TreeHPGuis[tree].Billboard:Destroy()
                        TreeHPGuis[tree] = nil
                    end
                end
            end
        end)
        
        Fluent:Notify({Title = "Tree HP On!", Content = "Bars enabled", Duration = 3})
    end

    local function DisableTreeHP()
        if not TreeHPToggle then return end
        TreeHPToggle = false
        
        for _, data in pairs(TreeHPGuis) do
            if data.Billboard then 
                data.Billboard:Destroy() 
            end
        end
        TreeHPGuis = {}
        
        for _, conn in pairs(TreeHPConnections) do
            if conn then conn:Disconnect() end
        end
        TreeHPConnections = {}
        
        Fluent:Notify({Title = "Tree HP Off", Content = "Bars removed", Duration = 2})
    end

    Tabs.chop:AddToggle("TreeHPBar", { Title = "Tree HP Bars", Default = false }):OnChanged(function(val)
        if val then EnableTreeHP() else DisableTreeHP() end
    end)
end

--------------------------------------------------------------------------------------------------------------
-- DRAGITEMS TAB
--------------------------------------------------------------------------------------------------------------
do
    local cloneref = cloneref or function(x) return x end

    local offsetDistance = 2
    local perItemDelay = 0

    local function asString(opt)
        if type(opt) == "table" then return tostring(opt[1]) end
        return tostring(opt)
    end

    local function getSortedItemNames()
        local itemsFolder = Workspace:WaitForChild("Items")
        local seen = {}
        for _, it in ipairs(itemsFolder:GetChildren()) do
            if it and it.Name then
                seen[it.Name] = true
            end
        end

        local names = {}
        for n in pairs(seen) do
            table.insert(names, n)
        end

        table.sort(names, function(a, b)
            return string.lower(a) < string.lower(b)
        end)

        if #names == 0 then
            names = {"(No items)"}
        end

        return names
    end

    local function findItemsByName(name, maxCount)
        local itemsFolder = Workspace:WaitForChild("Items")
        local list = {}
        for _, it in ipairs(itemsFolder:GetChildren()) do
            if it.Name == name then
                table.insert(list, it)
                if #list >= maxCount then
                    break
                end
            end
        end
        return list
    end

    local function dragOne(item)
        if not (item and item.Parent) then return false end

        local cloned = cloneref(item)

        local remoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")
        local startDragging = remoteEvents:WaitForChild("RequestStartDraggingItem")
        local stopDragging = remoteEvents:WaitForChild("StopDraggingItem")

        startDragging:FireServer(cloned)
        RS.Heartbeat:Wait()

        local pos = (hrp.CFrame * CFrame.new(0, 0, -offsetDistance)).Position

        task.spawn(function()
            if cloned:IsA("BasePart") then
                cloned.CFrame = CFrame.new(pos)
            elseif cloned:IsA("Model") and cloned.PrimaryPart then
                cloned:SetPrimaryPartCFrame(CFrame.new(pos))
            end
        end)

        task.wait(0.05)
        stopDragging:FireServer(cloned)
        return true
    end

    local options = getSortedItemNames()
    local selected = options[1] and asString(options[1]) or nil
    if selected == "(No items)" then selected = nil end

    local dropdown = Tabs.dragitems:AddDropdown("ItemDropdown", {
        Title = "Select Item (A-Z)",
        Values = options, Default = options[1]
    }):OnChanged(function(opt)
        selected = asString(opt)
        if selected == "(No items)" then selected = nil end
    end)

    Tabs.dragitems:AddButton({
        Title = "Refresh Items",
        Callback = function()
            options = getSortedItemNames()
            dropdown:SetValues(options)
            selected = options[1] and asString(options[1]) or nil
            if selected == "(No items)" then selected = nil else dropdown:SetValue(options[1]) end
            Fluent:Notify({Title = "Updated", Content = "Item list refreshed", Duration = 2})
        end
    })

    local currentQty = 10
    Tabs.dragitems:AddSlider("DragQty", {
        Title = "Quantity to Drag",
        Default = 10, Min = 1, Max = 500, Rounding = 1
    }):OnChanged(function(v) currentQty = v end)

    Tabs.dragitems:AddButton({
        Title = "Drag Selected Quantity",
        Callback = function()
            if not selected then
                Fluent:Notify({Title = "Error", Content = "Select item first", Duration = 2})
                return
            end

            local want = currentQty or 1
            local targets = findItemsByName(selected, want)

            if #targets == 0 then
                Fluent:Notify({Title = "Not Found", Content = "No " .. selected .. " to drag", Duration = 2})
                return
            end

            local dragged = 0
            for _, it in ipairs(targets) do
                if dragOne(it) then
                    dragged += 1
                end
                if perItemDelay > 0 then
                    task.wait(perItemDelay)
                end
            end

            Fluent:Notify({Title = "Success", Content = "Dragged " .. dragged .. " of " .. selected, Duration = 3})
        end
    })
end

--------------------------------------------------------------------------------------------------------------
-- MISC TAB
--------------------------------------------------------------------------------------------------------------
do
    local antiIdleEnabled = false
    local antiIdleConnection

    local function startAntiIdle()
        if antiIdleEnabled then return end
        antiIdleEnabled = true
        
        antiIdleConnection = RS.Heartbeat:Connect(function()
            if antiIdleEnabled then
                pcall(function()
                    game:GetService("VirtualUser"):CaptureController()
                    game:GetService("VirtualUser"):ClickButton2(Vector2.new())
                end)
            end
        end)
    end

    local function stopAntiIdle()
        antiIdleEnabled = false
        if antiIdleConnection then
            antiIdleConnection:Disconnect()
            antiIdleConnection = nil
        end
    end

    Tabs.misc:AddToggle("AntiIdle", { Title = "Anti Idle / AFK", Default = false }):OnChanged(function(val)
        if val then
            startAntiIdle()
            Fluent:Notify({Title = "Anti-AFK On", Content = "Won't kick", Duration = 4})
        else
            stopAntiIdle()
            Fluent:Notify({Title = "Anti-AFK Off", Content = "Beware of kick", Duration = 3})
        end
    end)

    local instantInteractEnabled = false
    local originalHoldDurations = {}
    local connections = {}

    local function setPrompt(prompt, enabled)
        if not prompt or not prompt.Parent then return end
        
        if enabled then
            if originalHoldDurations[prompt] == nil then
                originalHoldDurations[prompt] = prompt.HoldDuration
            end
            prompt.HoldDuration = 0
            prompt.MaxActivationDistance = 50
            prompt.RequiresLineOfSight = false
        else
            if originalHoldDurations[prompt] ~= nil then
                prompt.HoldDuration = originalHoldDurations[prompt]
                prompt.MaxActivationDistance = 10
                prompt.RequiresLineOfSight = true
            end
        end
    end

    local function enableInstant()
        if connections.enabled then return end
        
        for _, prompt in ipairs(workspace:GetDescendants()) do
            if prompt:IsA("ProximityPrompt") then
                setPrompt(prompt, true)
            end
        end

        connections.added = workspace.DescendantAdded:Connect(function(obj)
            if obj:IsA("ProximityPrompt") and instantInteractEnabled then
                task.wait()
                setPrompt(obj, true)
            end
        end)
        
        connections.enabled = true
    end

    local function disableInstant()
        if not connections.enabled then return end
        
        for prompt, _ in pairs(originalHoldDurations) do
            if prompt and prompt.Parent then
                setPrompt(prompt, false)
            end
        end
        
        originalHoldDurations = {}
        
        if connections.added then
            connections.added:Disconnect()
            connections.added = nil
        end
        
        connections.enabled = false
    end

    Tabs.misc:AddToggle("InstantInteract", { Title = "Instant Interact", Default = false }):OnChanged(function(state)
        instantInteractEnabled = state
        if state then
            enableInstant()
        else
            disableInstant()
        end
    end)
end

--------------------------------------------------------------------------------------------------------------
-- NIGHT TAB (Keep as is)
--------------------------------------------------------------------------------------------------------------
-- ... (keep the original night tab code)

--------------------------------------------------------------------------------------------------------------
-- OTHER TAB (Keep fog remover, freecam)
--------------------------------------------------------------------------------------------------------------
-- ... (keep the original other tab code)

--------------------------------------------------------------------------------------------------------------
-- UPDATE TAB (Update with new date)
--------------------------------------------------------------------------------------------------------------
do
    -- ... (original)
    Tabs.up:AddParagraph({
        Title = "Update 11/29/2025",
        Content = "Merged with Life Sara script: added godmode, fills, kill aura, chop aura, drag items, misc features, places warp, etc."
    })
end

--------------------------------------------------------------------------------------------------------------
-- CREDIT TAB (Add more credits)
--------------------------------------------------------------------------------------------------------------
do
    -- ... (original)
    Tabs.credit:AddParagraph({
        Title = "Additional Credits",
        Content = "Merged features from Life Sara v2.0 script"
    })
end

--------------------------------------------------------------------------------------------------------------
-- DEV TAB (Former Main)
--------------------------------------------------------------------------------------------------------------
-- ... (original dev tab)

--------------------------------------------------------------------------------------------------------------
-- SYSTEM CONFIG
--------------------------------------------------------------------------------------------------------------
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)
Fluent:Notify({
    Title = "Power Panel",
    Content = "Merged script loaded.",
    Duration = 8
})
SaveManager:LoadAutoloadConfig()
